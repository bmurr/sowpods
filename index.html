<html>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<head>
		<link
			rel="shortcut icon"
			href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='.8 .8 14.4 14.4'><path d='M10 8.99a1 1 0 00-.695 1.717l4.004 4a1 1 0 101.414-1.414l-4.004-4A1 1 0 0010 8.99z' fill='%2380b0ff' stroke='%235D7FDDaa' stroke-width='.3'/><path d='M6.508 1C3.48 1 1.002 3.474 1.002 6.5S3.48 12 6.508 12s5.504-2.474 5.504-5.5S9.536 1 6.508 1zm0 2a3.486 3.486 0 013.504 3.5c0 1.944-1.556 3.5-3.504 3.5a3.488 3.488 0 01-3.506-3.5C3.002 4.556 4.56 3 6.508 3z' fill='%2380b0ff' stroke='%235D7FDDaa' stroke-width='.3'/></svg>"
		/>
		<style>
				html, body {
		margin: 0;
		padding: 0;
		height: 100%;
		font-family: Arial, sans-serif;
		background-color: #f5f5f5;
		color: #333;
		box-sizing: border-box;
		overflow: hidden; 
	}

	#container {
		display: flex;
		flex-direction: column;
		height: 100%;
		gap: 10px;
		padding: 10px;
	}

	#words, #tools {
		background-color: #fff;
		border-radius: 6px;
		box-shadow: 0 2px 6px rgba(0,0,0,0.1);
		padding: 10px;
	}

	#scrollbox{
		position:relative;
  		height:100%;
  		overflow-y:auto;
  		border:1px solid #ccc;
		border-radius:5px;
		background:#fff;
		font-family:sans-serif;
	}

/* Smooth scrolling */
#scrollbox {
  -webkit-overflow-scrolling: touch; /* momentum scroll on iOS */
  scroll-behavior: smooth;
}

/* Hide or slim scrollbars */
#scrollbox::-webkit-scrollbar {
  width: 1em;
  height: 2em;
}
#scrollbox::-webkit-scrollbar-track {
  background: transparent;
}
#scrollbox::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.2);
  border-radius: 3px;
}

	#words {
		flex: 1;
		overflow-y: hidden;
	}

	#tools {
		flex-basis: 40%;
	}

	.input-group{
		display: flex;
		padding: 2px 0;
	}



    .input-group {
    	display: flex;
      flex-direction: row;
    }
    .input-group .regexCondition{
    	width: 75%;
    }

    .input-group button {
      width: 25%;

     }

    button{
    padding: 8px 12px;
    font-size: 1rem;
  
    }
	
	</style>
	</head>
	<body>
		<div id="container">
			<div id="words"><div id="scrollbox"></div></div>
			<div id="tools">
				<form id="toolForm">
					<div id="conditions"></div>					
					<button type="button" onclick="document.querySelector('#toolForm').requestSubmit()">Filter</button>
					<input type="submit" hidden />
				</form>
			</div>
		</div>

		<template id="singleCondition">
			<div class="input-group">
		  		<input type="text" class="regexCondition" placeholder="Regex here..."></input>
		  		<button type="button" onclick="addCondition(this)">+</button>					
			</div>
		</template>

		<template id="condition">
			<div class="input-group">
			  <input type="text" class="regexCondition" placeholder="Regex here..."></input>
			  <button type="button" onclick="addCondition(this)">+</button>
			  <button type="button" onclick="removeCondition(this)">-</button>
			</div>
		</template>

	</body>
	<script>
		var globals = {};

		async function getSowpods() {
			let r = await fetch('resources/sowpods.txt');
			return r.text();
			
		}

		async function getWordList(){
			globals.sowpods = await getSowpods();
			globals.sowpods = globals.sowpods.toLowerCase();
			globals.wordlist = globals.sowpods.split(/\n/);
			globals.filteredWordList = globals.wordlist;
		}
	
		function filterWords(){
			
			const regexInputs = document.querySelectorAll('#conditions .regexCondition');
			const regexValues = Array.from(regexInputs).map(e => e.value);

			
			let newWords = globals.wordlist;
			for (let v of regexValues){
				if (v){
					newWords = newWords.filter(w => w.match(v));												
				} 
			}
			
			globals.filteredWordList = newWords;		
		}

		function addCondition(button){
			const condition = document.getElementById('condition');
		    const clone = condition.content.cloneNode(true);
			document.querySelector('#conditions').appendChild(clone);
		}

		function removeCondition(button){
			button.parentElement.remove();
		}

		function init(){
			document.querySelector('#toolForm').addEventListener('submit', e => {
				e.preventDefault();
				e.stopPropagation();
				filterWords();
				updateVirtualScroller(globals.filteredWordList);
			});

			const condition = document.getElementById('singleCondition');
		    const clone = condition.content.cloneNode(true);
			document.querySelector('#conditions').appendChild(clone);
		}

		function updateVirtualScroller(items){
			const box = document.getElementById('scrollbox');
			box.innerText = "";
			const total = items.length;
			const itemHeight = 25;
			const visible = 20;
			const spacer = document.createElement('div');
			spacer.style.height = total * itemHeight + 'px';
			box.appendChild(spacer);

			const pool = [];
			for (let i = 0; i < visible; i++) {
			  const el = document.createElement('div');
			  el.style.cssText = `position:absolute; height:${itemHeight}px;
			    line-height:${itemHeight}px; left:0; right:0; padding:0 8px;
			    border-bottom:1px solid #eee;`;
			  pool.push(el);
			  box.appendChild(el);
			}

			box.addEventListener('scroll', () => {
			  const start = Math.floor(box.scrollTop / itemHeight);
			  pool.forEach((el, i) => {
			    const index = start + i;
			    if (index < total) {
			      el.textContent = items[index];
			      el.style.top = index * itemHeight + 'px';
			    }
			  });
			});

			box.dispatchEvent(new Event('scroll'));
		}

		async function main() {	
			await getWordList();
			updateVirtualScroller(globals.filteredWordList );
			
		}

		document.addEventListener('DOMContentLoaded', () => {
			init();
			main();
		});
	</script>
</html>
